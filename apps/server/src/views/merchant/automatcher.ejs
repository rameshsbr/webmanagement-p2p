<% layout('merchant/layout') -%>

<div class="card">
  <div class="row" style="justify-content:space-between; align-items:flex-end; gap:16px; flex-wrap:wrap">
    <div>
      <h2>AUD Â· Automatcher</h2>
      <p class="muted">Read-only Automatcher profiles for your clients.</p>
    </div>
    <form method="GET" action="/merchant/clients/automatcher" class="row" style="gap:8px">
      <input class="input" type="text" name="q" value="<%= query.q || '' %>" placeholder="Search client/user" />
      <button class="btn small" type="submit">Search</button>
    </form>
  </div>
</div>

<div class="card" style="margin-top:16px">
  <table class="table">
    <thead>
      <tr>
        <th>ClientUniqueId</th>
        <th>User</th>
        <th>Automatcher Status</th>
        <th>BSB</th>
        <th>Account No</th>
        <th>Account Name</th>
        <th>PayID Type</th>
        <th>PayID</th>
        <th>PayID Name</th>
        <th>PayID Status</th>
        <th>Created</th>
        <th>Updated</th>
      </tr>
    </thead>
    <tbody>
      <% if (Array.isArray(rows) && rows.length) { %>
        <% rows.forEach((row) => { %>
          <tr>
            <td class="mono"><%= row.clientUniqueId %></td>
            <td>
              <div><%= row.user?.fullName || row.user?.email || row.user?.publicId || '-' %></div>
              <div class="muted"><%= row.user?.email || '' %></div>
            </td>
            <td><%= row.status || '-' %></td>
            <td class="mono"><%= row.bsb || '-' %></td>
            <td class="mono"><%= row.bankAccountNumber || '-' %></td>
            <td><%= row.bankAccountName || '-' %></td>
            <td><%= row.payIdType || '-' %></td>
            <td class="mono"><%= row.payIdValue || '-' %></td>
            <td><%= row.payIdName || '-' %></td>
            <td><%= row.payIdStatus || '-' %></td>
            <td><%= formatDateTime(row.createdAt, res.locals.getTimezone()) %></td>
            <td><%= formatDateTime(row.updatedAt, res.locals.getTimezone()) %></td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr><td colspan="12" class="muted">No Automatcher profiles found.</td></tr>
      <% } %>
    </tbody>
  </table>
</div>
