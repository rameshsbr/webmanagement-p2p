<% /* Filters Bar aligned with admin/merchant queries */ %>
<% const statusSelected = new Set(String(query.status||'').split(',').map(s=>s.trim()).filter(Boolean)); %>
<form class="card filters" method="GET" action="">
  <div class="filters-grid grid-4">
    <!-- Date range -->
    <div class="f-item">
      <label>Date range</label>
      <div class="range-input" data-range>
        <input type="hidden" name="from" value="<%= (query.from||'') %>">
        <input type="hidden" name="to"   value="<%= (query.to||'') %>">
        <span class="range-display">
          <%= (query.from && query.to)
                ? (new Date(query.from)).toLocaleString() + ' ~ ' + (new Date(query.to)).toLocaleString()
                : 'dd/mm/yyyy hh:mm ~ dd/mm/yyyy hh:mm' %>
        </span>
        <button class="btn btn-icon" type="button" data-range-open aria-label="Open date range">ðŸ“…</button>

        <div class="range-pop" data-range-pop>
          <div class="pop-row">
            <label>From</label>
            <input type="datetime-local" data-range-from>
          </div>
          <div class="pop-row">
            <label>To</label>
            <input type="datetime-local" data-range-to>
          </div>
          <div class="pop-actions">
            <button type="button" class="btn ghost"   data-range-clear>Clear</button>
            <button type="button" class="btn primary" data-range-apply>Apply</button>
            <button type="button" class="btn btn-icon" title="Close" aria-label="Close" data-range-close>âœ•</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Date field -->
    <div class="f-item">
      <label>Date field</label>
      <select name="dateField">
        <option value="createdAt" <%= (query.dateField||'createdAt')==='createdAt' ? 'selected' : '' %>>Date of creation</option>
        <option value="updatedAt" <%= (query.dateField||'')==='updatedAt' ? 'selected' : '' %>>Date processed</option>
      </select>
    </div>

    <!-- Transaction ID -->
    <div class="f-item">
      <label>Transaction ID</label>
      <input type="text" name="reference" value="<%= query.reference||'' %>" placeholder="T12345">
    </div>

    <!-- User ID -->
    <div class="f-item">
      <label>User ID</label>
      <input type="text" name="userId" value="<%= query.userId||'' %>" placeholder="U123456">
    </div>

    <!-- Merchant ID -->
    <div class="f-item">
      <label>Merchant ID</label>
      <input type="text" name="merchantId" value="<%= query.merchantId||'' %>" placeholder="Merchant ID">
    </div>

    <!-- Merchant name -->
    <div class="f-item">
      <label>Merchant name</label>
      <input type="text" name="merchantName" value="<%= query.merchantName||'' %>" placeholder="Merchant name">
    </div>

    <!-- Admin ID -->
    <div class="f-item">
      <label>Admin ID</label>
      <input type="text" name="processedBy" value="<%= query.processedBy||'' %>" placeholder="Admin ID">
    </div>

    <!-- Admin name -->
    <div class="f-item">
      <label>Admin name</label>
      <input type="text" name="processedByName" value="<%= query.processedByName||'' %>" placeholder="Admin name">
    </div>

    <!-- Method -->
    <div class="f-item">
      <label>Method</label>
      <select name="method">
        <option value="" <%= (query.method||'')==='' ? 'selected' : '' %>>All methods</option>
        <option value="OSKO" <%= (query.method||'')==='OSKO' ? 'selected' : '' %>>OSKO</option>
        <option value="PAYID" <%= (query.method||'')==='PAYID' ? 'selected' : '' %>>PayID</option>
      </select>
    </div>

    <!-- Status -->
    <div class="f-item">
      <label>Status</label>
      <select name="status">
        <option value=""           <%= statusSelected.size===0 ? 'selected' : '' %>>All statuses</option>
        <option value="PENDING"    <%= statusSelected.has('PENDING') && statusSelected.size===1 ? 'selected' : '' %>>Pending</option>
        <option value="SUBMITTED"  <%= statusSelected.has('SUBMITTED') && statusSelected.size===1 ? 'selected' : '' %>>Submitted</option>
        <option value="APPROVED"   <%= statusSelected.has('APPROVED') && statusSelected.size===1 ? 'selected' : '' %>>Approved</option>
        <option value="REJECTED"   <%= statusSelected.has('REJECTED') && statusSelected.size===1 ? 'selected' : '' %>>Rejected</option>
      </select>
    </div>

    <!-- Currency -->
    <div class="f-item">
      <label>Currency</label>
      <input type="text" name="currency" value="<%= query.currency||'' %>" placeholder="Currency">
    </div>

    <!-- Bank ID -->
    <div class="f-item">
      <label>Bank ID</label>
      <input type="text" name="bankId" value="<%= query.bankId||'' %>" placeholder="Bank ID">
    </div>

    <!-- Amount range -->
    <div class="f-item">
      <label>Amount range</label>
      <div class="row" style="gap:6px">
        <input class="input" type="number" step="0.01" name="amountMin" value="<%= query.amountMin || '' %>" placeholder="Min">
        <input class="input" type="number" step="0.01" name="amountMax" value="<%= query.amountMax || '' %>" placeholder="Max">
      </div>
    </div>

    <!-- Keyword search -->
    <div class="f-item">
      <label>Keyword</label>
      <input type="text" name="q" value="<%= query.q||'' %>" placeholder="Search ID / user">
    </div>
  </div>

  <div class="f-actions">
    <% if (typeof type !== 'undefined' && type) { %>
      <input type="hidden" name="type" value="<%= type %>">
    <% } %>
    <button type="submit" class="btn primary">APPLY</button>
  </div>
</form>
