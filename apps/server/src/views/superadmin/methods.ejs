<% layout('superadmin/layout') -%>

<div class="page methods-page">
  <div class="page__header">
    <div>
      <h1>Methods</h1>
      <p class="muted">Manage payment methods, assignments, and usage.</p>
    </div>
  </div>

  <div class="card methods-card">
    <form method="post" action="/superadmin/methods" class="methods-add" data-methods-form="create">
      <div class="form-field">
        <label for="method-code">Code</label>
        <input id="method-code" class="input" required name="code" placeholder="OSKO" style="text-transform:uppercase;" />
      </div>
      <div class="form-field">
        <label for="method-name">Name</label>
        <input id="method-name" class="input" required name="name" placeholder="Osko" />
      </div>
      <div class="form-field form-field--inline">
        <label for="method-enabled">Enabled</label>
        <input id="method-enabled" type="checkbox" name="enabled" checked />
      </div>
      <div class="form-field methods-add__actions">
        <button class="btn primary" type="submit">Add method</button>
      </div>
    </form>

    <% if (!methods.length) { %>
      <p class="muted" style="margin: 12px 0;">No methods available yet.</p>
    <% } else { %>
      <div class="table-wrap">
        <table class="table methods-table">
          <thead>
            <tr>
              <th>Method</th>
              <th>Code</th>
              <th>Enabled</th>
              <th>Merchants</th>
              <th>Deposits</th>
              <th>Withdrawals</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% methods.forEach((method) => { const stat = stats[method.id] || { merchants: 0, deposits: 0, withdrawals: 0 }; const formId = `method-form-${method.id}`; %>
              <form id="<%= formId %>" method="post" action="/superadmin/methods/<%= method.id %>" data-methods-form="row"></form>
              <tr>
                <td>
                  <input class="input" form="<%= formId %>" name="name" value="<%= method.name %>" />
                </td>
                <td class="mono"><%= method.code %></td>
                <td class="enabled-cell">
                  <input form="<%= formId %>" type="checkbox" name="enabled" <%= method.enabled ? 'checked' : '' %> />
                </td>
                <td class="number-cell"><%= stat.merchants %></td>
                <td class="number-cell"><%= stat.deposits %></td>
                <td class="number-cell"><%= stat.withdrawals %></td>
                <td class="actions-cell">
                  <button class="btn small" type="submit" form="<%= formId %>">Save</button>
                  <a class="btn small" href="/superadmin/methods/<%= method.id %>/merchants">Assign merchants</a>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>
</div>
